<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Season - Players with 1+ bWAR</title>
    <meta name="description" content="Interactive visualization of 2025 MLB players with 1+ WAR by team">
    <meta property="og:title" content="2025 Season - Players with 1+ bWAR">
    <meta property="og:description" content="Interactive chart: Offensive WAR vs Defensive WAR - Filter by Team">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(to bottom right, #f8fafc, #dbeafe);
            min-height: 100vh;
            padding: 1rem;
        }
        #root { max-width: 1400px; margin: 0 auto; }
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .filters-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4b5563;
        }
        .filter-box label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        .filter-box select {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            min-width: 180px;
            cursor: pointer;
        }
        .filter-box select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .player-count {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .chart-wrapper { 
            position: relative; 
            overflow-x: auto;
            overflow-y: visible;
        }
        .chart-scroll {
            min-width: 900px;
        }
        svg { display: block; margin: 0 auto; }
        .tooltip {
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            font-size: 0.875rem;
            pointer-events: none;
            z-index: 10;
        }
        .tooltip-name { font-weight: bold; margin-bottom: 0.25rem; }
        .footnote, .source {
            position: absolute;
            font-size: 11px;
            color: #6b7280;
        }
        .source { bottom: 10px; left: 60px; }
        .footnote { bottom: 10px; right: 40px; }
        .cursor-pointer { cursor: pointer; }
        .loading { text-align: center; padding: 2rem; color: #6b7280; }
        @media (max-width: 1024px) {
            body { padding: 0.5rem; }
            .chart-container { padding: 1rem; border-radius: 8px; }
            h1 { font-size: 1.25rem; }
            .subtitle { font-size: 0.8rem; }
            .header-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function WARChart() {
            const [allData, setAllData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [hoveredPlayer, setHoveredPlayer] = useState(null);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            const [selectedTeam, setSelectedTeam] = useState('All Teams');
            const [selectedPosition, setSelectedPosition] = useState('All Positions');

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const sheetId = '1GdzvNZatJglE63Oh493LGgwTRS2nA-rxks5Qpw95sCQ';
                        const gid = '0';
                        const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;
                        
                        const response = await fetch(csvUrl);
                        const csvText = await response.text();
                        
                        const lines = csvText.split('\n').filter(line => line.trim());
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        const jsonData = [];
                        for (let i = 1; i < lines.length; i++) {
                            // Handle CSV values that might contain commas within quotes
                            const line = lines[i];
                            const values = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let char of line) {
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim().replace(/^"|"$/g, ''));
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            values.push(current.trim().replace(/^"|"$/g, ''));
                            
                            if (values.length >= 9 && values[0]) {
                                const row = {
                                    Player: values[0],
                                    Team: values[1],
                                    WAR: parseFloat(values[2]),
                                    oWAR: parseFloat(values[3]),
                                    dWAR: parseFloat(values[4]),
                                    Position: values[8] || '' // Position - Final column (column I = index 8)
                                };
                                if (!isNaN(row.WAR) && !isNaN(row.oWAR) && !isNaN(row.dWAR)) {
                                    jsonData.push(row);
                                }
                            }
                        }
                        
                        setAllData(jsonData);
                        console.log('Loaded', jsonData.length, 'players');
                        console.log('Sample positions:', jsonData.slice(0, 5).map(p => `${p.Player}: "${p.Position}"`));
                        setLoading(false);
                    } catch (err) {
                        console.error('Error loading data:', err);
                        setError(err.message);
                        setLoading(false);
                    }
                };
                loadData();
            }, []);

            if (loading) return <div className="loading">Loading data...</div>;
            if (error) return <div className="loading">Error: {error}</div>;
            if (allData.length === 0) return <div className="loading">No data available</div>;

            const teams = ['All Teams', ...new Set(allData.map(p => p.Team))].sort((a, b) => {
                if (a === 'All Teams') return -1;
                if (b === 'All Teams') return 1;
                return a.localeCompare(b);
            });

            const positions = ['All Positions', 'P', 'C', '1B', '2B', 'SS', '3B', 'LF', 'CF', 'RF', 'DH'];

            // Apply both filters
            let data = allData;
            if (selectedTeam !== 'All Teams') {
                data = data.filter(p => p.Team === selectedTeam);
            }
            if (selectedPosition !== 'All Positions') {
                data = data.filter(p => {
                    if (!p.Position) return false;
                    // Split by comma and check if any position matches exactly
                    const positions = p.Position.split(',').map(pos => pos.trim());
                    return positions.includes(selectedPosition);
                });
            }

            const width = 900;
            const height = 600;
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const allOWARValues = allData.map(d => d.oWAR);
            const allDWARValues = allData.map(d => d.dWAR);
            const minOWAR = Math.min(...allOWARValues);
            const maxOWAR = Math.max(...allOWARValues);
            const minDWAR = Math.min(...allDWARValues);
            const maxDWAR = Math.max(...allDWARValues);

            const oWARRange = maxOWAR - minOWAR;
            const dWARRange = maxDWAR - minDWAR;
            const xMin = minOWAR - oWARRange * 0.1;
            const xMax = maxOWAR + oWARRange * 0.1;
            const yMin = minDWAR - dWARRange * 0.1;
            const yMax = maxDWAR + dWARRange * 0.1;

            const scaleX = (val) => ((val - xMin) / (xMax - xMin)) * chartWidth;
            const scaleY = (val) => chartHeight - ((val - yMin) / (yMax - yMin)) * chartHeight;
            
            const minWAR = Math.min(...allData.map(d => d.WAR));
            const maxWAR = Math.max(...allData.map(d => d.WAR));
            const scaleRadius = (war) => 5 + ((war - minWAR) / (maxWAR - minWAR)) * 20;

            const xTicks = [];
            const yTicks = [];
            for (let i = 0; i <= 10; i++) {
                xTicks.push(xMin + (xMax - xMin) * (i / 10));
                yTicks.push(yMin + (yMax - yMin) * (i / 10));
            }

            const handleMouseMove = (e, player) => {
                const svg = e.currentTarget.closest('svg');
                const rect = svg.getBoundingClientRect();
                setMousePos({ x: e.clientX - rect.left, y: e.clientY - rect.top });
                setHoveredPlayer(player);
            };

            const oWARMedian = [...allOWARValues].sort((a, b) => a - b)[Math.floor(allOWARValues.length / 2)];

            return (
                <div className="chart-container">
                    <div className="header-row">
                        <div>
                            <h1>2025 Season - Players with 1+ bWAR</h1>
                            <p className="subtitle">Offensive WAR vs Defensive WAR (bubble size = total WAR)</p>
                        </div>
                        <div className="filters-container">
                            <div className="filter-box">
                                <label>Filter by Team</label>
                                <select value={selectedTeam} onChange={(e) => setSelectedTeam(e.target.value)}>
                                    {teams.map(team => (
                                        <option key={team} value={team}>{team}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="filter-box">
                                <label>Filter by Position</label>
                                <select value={selectedPosition} onChange={(e) => setSelectedPosition(e.target.value)}>
                                    {positions.map(pos => (
                                        <option key={pos} value={pos}>{pos}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>
                    <p className="player-count" style={{marginBottom: '1rem', color: '#6b7280', fontSize: '0.875rem'}}>
                        {data.length} players shown
                    </p>
                    
                    <div className="chart-wrapper">
                        <div className="chart-scroll">
                            <svg width={width} height={height}>
                                <g transform={`translate(${margin.left},${margin.top})`}>
                                    {xTicks.map((tick, i) => (
                                        <line key={`x-grid-${i}`} x1={scaleX(tick)} y1={0} x2={scaleX(tick)} y2={chartHeight} stroke="#e5e7eb" strokeWidth="1" />
                                    ))}
                                    {yTicks.map((tick, i) => (
                                        <line key={`y-grid-${i}`} x1={0} y1={scaleY(tick)} x2={chartWidth} y2={scaleY(tick)} stroke="#e5e7eb" strokeWidth="1" />
                                    ))}

                                    <rect x={0} y={scaleY(0)} width={chartWidth} height={chartHeight - scaleY(0)} fill="#fee2e2" opacity={0.3} />
                                    <line x1={0} y1={scaleY(0)} x2={chartWidth} y2={scaleY(0)} stroke="#9ca3af" strokeWidth="2" strokeDasharray="5,5" />
                                    
                                    <text x={scaleX(oWARMedian) - chartWidth * 0.2} y={25} textAnchor="middle" style={{fontSize: '14px', fontWeight: '600', fill: '#6b7280'}}>
                                        Defensive Wizards
                                    </text>
                                    <text x={scaleX(oWARMedian) + chartWidth * 0.25} y={scaleY(yMax) + 85} textAnchor="middle" style={{fontSize: '14px', fontWeight: '600', fill: '#6b7280'}}>
                                        All-Around Players
                                    </text>
                                    <text x={scaleX(8.5)} y={scaleY(0) - 30} textAnchor="middle" style={{fontSize: '14px', fontWeight: '600', fill: '#6b7280'}}>
                                        Elite Hitters
                                    </text>
                                    <text x={scaleX(oWARMedian) + chartWidth * 0.2} y={chartHeight - 20} textAnchor="middle" style={{fontSize: '14px', fontWeight: '600', fill: '#6b7280'}}>
                                        At Least They Can Hit
                                    </text>

                                    <line x1={0} y1={chartHeight} x2={chartWidth} y2={chartHeight} stroke="#374151" strokeWidth="2" />
                                    {xTicks.filter((_, i) => i % 2 === 0).map((tick, i) => (
                                        <g key={`x-tick-${i}`}>
                                            <line x1={scaleX(tick)} y1={chartHeight} x2={scaleX(tick)} y2={chartHeight + 6} stroke="#374151" strokeWidth="2" />
                                            <text x={scaleX(tick)} y={chartHeight + 20} textAnchor="middle" style={{fontSize: '12px', fill: '#4b5563'}}>{tick.toFixed(1)}</text>
                                        </g>
                                    ))}
                                    <text x={chartWidth / 2} y={chartHeight + 45} textAnchor="middle" style={{fontSize: '14px', fontWeight: '600', fill: '#1f2937'}}>
                                        Offensive WAR (oWAR)
                                    </text>

                                    <line x1={0} y1={0} x2={0} y2={chartHeight} stroke="#374151" strokeWidth="2" />
                                    {yTicks.filter((_, i) => i % 2 === 0).map((tick, i) => (
                                        <g key={`y-tick-${i}`}>
                                            <line x1={0} y1={scaleY(tick)} x2={-6} y2={scaleY(tick)} stroke="#374151" strokeWidth="2" />
                                            <text x={-10} y={scaleY(tick)} textAnchor="end" dominantBaseline="middle" style={{fontSize: '12px', fill: '#4b5563'}}>{tick.toFixed(1)}</text>
                                        </g>
                                    ))}
                                    <text x={-35} y={chartHeight / 2} textAnchor="middle" transform={`rotate(-90, -35, ${chartHeight / 2})`} style={{fontSize: '14px', fontWeight: '600', fill: '#1f2937'}}>
                                        Defensive WAR (dWAR)
                                    </text>

                                    {data.map((player, i) => {
                                        const x = scaleX(player.oWAR);
                                        const y = scaleY(player.dWAR);
                                        const r = scaleRadius(player.WAR);
                                        const isHovered = hoveredPlayer?.Player === player.Player;

                                        return (
                                            <circle
                                                key={i}
                                                cx={x} cy={y} r={r}
                                                fill={isHovered ? "#2563eb" : "#3b82f6"}
                                                fillOpacity={isHovered ? 0.9 : 0.6}
                                                stroke={isHovered ? "#1e40af" : "#2563eb"}
                                                strokeWidth={isHovered ? 2 : 1}
                                                className="cursor-pointer"
                                                onMouseMove={(e) => handleMouseMove(e, player)}
                                                onMouseLeave={() => setHoveredPlayer(null)}
                                            />
                                        );
                                    })}
                                </g>
                            </svg>

                            {hoveredPlayer && (
                                <div className="tooltip" style={{ left: mousePos.x + 15, top: mousePos.y - 10 }}>
                                    <div className="tooltip-name">{hoveredPlayer.Player}</div>
                                    <div>Team: {hoveredPlayer.Team}</div>
                                    <div>Position: {hoveredPlayer.Position}</div>
                                    <div>Total WAR: {hoveredPlayer.WAR.toFixed(1)}</div>
                                    <div>oWAR: {hoveredPlayer.oWAR.toFixed(1)}</div>
                                    <div>dWAR: {hoveredPlayer.dWAR.toFixed(1)}</div>
                                </div>
                            )}
                            
                            <div className="source">
                                Source: Baseball Reference
                            </div>
                            
                            <div className="footnote">
                                *Does not include pitching WAR
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<WARChart />, document.getElementById('root'));
    </script>
</body>
</html>
ˇ